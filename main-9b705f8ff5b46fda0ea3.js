(()=>{"use strict";class t{constructor(t,e=null,o="normal",s=!1){this.title=t,this.dueDate=e,this.priority=o,this.done=s}toggleDone(){this.done=!this.done}}class e{constructor(t,e,o){this.container=t,this.onToggle=e,this.onDelete=o,this.container.addEventListener("click",t=>{const e=t.target.closest("button");if(!e)return;const o=Number(e.dataset.index);e.classList.contains("toggleBtn")&&this.onToggle(o),e.classList.contains("deleteBtn")&&this.onDelete(o)})}render(t){this.container.innerHTML="",t.forEach((t,e)=>{const o=document.createElement("li");o.classList.add(t.priority),o.innerHTML=`\n        <span>\n          <strong>${t.title}</strong> (Due: ${t.dueDate})\n        </span>\n        <div>\n          <button data-index="${e}" class="toggleBtn">${t.done?"✔️":"⬜"}</button>\n          <button data-index="${e}" class="deleteBtn">🗑️</button>\n        </div>\n      `,t.done&&(o.style.textDecoration="line-through"),this.container.appendChild(o)})}}class o{static fromPlainObject(e){return new t(e.title,e.dueDate,e.priority,e.done)}static fromArray(t){return t.map(t=>this.fromPlainObject(t))}}class s{static save(t){localStorage.setItem("todos",JSON.stringify(t))}static load(){const t=localStorage.getItem("todos");if(!t)return[];try{const e=JSON.parse(t);return o.fromArray(e)}catch(t){return console.error("Fail to parse data from localStorage",t),[]}}}class n{constructor(t,o){this.todos=s.load(),this.form=t,this.renderer=new e(o,this.toggleTodo.bind(this),this.deleteTodo.bind(this)),this.form.addEventListener("submit",this.addTodo.bind(this)),this.renderer.render(this.todos)}addTodo(e){e.preventDefault();const o=this.form.querySelector("#title").value.trim(),s=this.form.querySelector("#dueDate").value,n=this.form.querySelector("#priority").value;this.todos.push(new t(o,s,n)),this._update(),this.form.reset()}toggleTodo(t){this.todos[t].toggleDone(),this._update()}deleteTodo(t){this.todos.splice(t,1),this._update()}_update(){s.save(this.todos),this.renderer.render(this.todos)}}document.addEventListener("DOMContentLoaded",()=>{const t=document.querySelector("form"),e=document.querySelector("ul");new n(t,e)})})();